{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://waternity.com/schemas/valve_command.schema.json",
  "title": "Valve Command Event Schema",
  "description": "Schema for valve control command events",
  "allOf": [
    {
      "$ref": "./common.hcs.schema.json"
    },
    {
      "type": "object",
      "properties": {
        "eventType": {
          "const": "valve_command"
        },
        "data": {
          "type": "object",
          "properties": {
            "wellId": {
              "type": "string",
              "pattern": "^WL-[0-9]{3}$",
              "description": "Well identifier (e.g., WL-001)"
            },
            "valveId": {
              "type": "string",
              "description": "Unique valve identifier"
            },
            "command": {
              "type": "object",
              "properties": {
                "action": {
                  "type": "string",
                  "enum": ["OPEN", "CLOSE", "ADJUST", "EMERGENCY_STOP"],
                  "description": "Valve action to perform"
                },
                "position": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Target valve position percentage (0-100)"
                },
                "flowRate": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Target flow rate in liters per minute"
                },
                "priority": {
                  "type": "string",
                  "enum": ["LOW", "NORMAL", "HIGH", "EMERGENCY"],
                  "default": "NORMAL",
                  "description": "Command priority level"
                },
                "scheduledTime": {
                  "type": "string",
                  "format": "date-time",
                  "description": "When the command should be executed (optional for immediate execution)"
                },
                "duration": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Command duration in seconds (0 for indefinite)"
                }
              },
              "required": ["action"],
              "additionalProperties": false,
              "if": {
                "properties": {
                  "action": { "const": "ADJUST" }
                }
              },
              "then": {
                "required": ["action", "position"]
              }
            },
            "authorization": {
              "type": "object",
              "properties": {
                "operatorId": {
                  "type": "string",
                  "description": "ID of the operator issuing the command"
                },
                "authToken": {
                  "type": "string",
                  "description": "Authorization token for the command"
                },
                "reason": {
                  "type": "string",
                  "description": "Reason for the valve command"
                }
              },
              "required": ["operatorId"],
              "additionalProperties": false
            },
            "conditions": {
              "type": "object",
              "properties": {
                "minPressure": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Minimum pressure required for command execution"
                },
                "maxPressure": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Maximum pressure allowed for command execution"
                },
                "temperatureRange": {
                  "type": "object",
                  "properties": {
                    "min": {
                      "type": "number",
                      "description": "Minimum temperature in Celsius"
                    },
                    "max": {
                      "type": "number",
                      "description": "Maximum temperature in Celsius"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "location": {
              "type": "object",
              "properties": {
                "latitude": {
                  "type": "number",
                  "minimum": -90,
                  "maximum": 90,
                  "description": "GPS latitude"
                },
                "longitude": {
                  "type": "number",
                  "minimum": -180,
                  "maximum": 180,
                  "description": "GPS longitude"
                }
              },
              "required": ["latitude", "longitude"],
              "additionalProperties": false
            }
          },
          "required": ["wellId", "valveId", "command", "authorization"],
          "additionalProperties": false
        }
      },
      "required": ["eventType", "data"]
    }
  ]
}