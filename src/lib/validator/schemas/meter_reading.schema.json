{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://waternity.com/schemas/meter_reading.schema.json",
  "title": "Meter Reading Event Schema",
  "description": "Schema for water meter reading events",
  "allOf": [
    {
      "$ref": "./common.hcs.schema.json"
    },
    {
      "type": "object",
      "properties": {
        "eventType": {
          "const": "meter_reading"
        },
        "data": {
          "type": "object",
          "properties": {
            "wellId": {
              "type": "string",
              "pattern": "^WL-[0-9]{3}$",
              "description": "Well identifier (e.g., WL-001)"
            },
            "meterId": {
              "type": "string",
              "description": "Unique meter identifier"
            },
            "reading": {
              "type": "object",
              "properties": {
                "value": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Meter reading value"
                },
                "unit": {
                  "type": "string",
                  "enum": ["liters", "cubic_meters", "gallons"],
                  "description": "Unit of measurement"
                },
                "timestamp": {
                  "type": "string",
                  "format": "date-time",
                  "description": "When the reading was taken"
                },
                "quality": {
                  "type": "object",
                  "properties": {
                    "ph": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 14,
                      "description": "pH level"
                    },
                    "turbidity": {
                      "type": "number",
                      "minimum": 0,
                      "description": "Turbidity in NTU"
                    },
                    "chlorine": {
                      "type": "number",
                      "minimum": 0,
                      "description": "Chlorine level in mg/L"
                    },
                    "temperature": {
                      "type": "number",
                      "description": "Water temperature in Celsius"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "required": ["value", "unit", "timestamp"],
              "additionalProperties": false
            },
            "location": {
              "type": "object",
              "properties": {
                "latitude": {
                  "type": "number",
                  "minimum": -90,
                  "maximum": 90,
                  "description": "GPS latitude"
                },
                "longitude": {
                  "type": "number",
                  "minimum": -180,
                  "maximum": 180,
                  "description": "GPS longitude"
                },
                "altitude": {
                  "type": "number",
                  "description": "Altitude in meters"
                }
              },
              "required": ["latitude", "longitude"],
              "additionalProperties": false
            },
            "deviceInfo": {
              "type": "object",
              "properties": {
                "serialNumber": {
                  "type": "string",
                  "description": "Device serial number"
                },
                "firmwareVersion": {
                  "type": "string",
                  "description": "Device firmware version"
                },
                "batteryLevel": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Battery level percentage"
                }
              },
              "additionalProperties": false
            }
          },
          "required": ["wellId", "meterId", "reading"],
          "additionalProperties": false
        }
      },
      "required": ["eventType", "data"]
    }
  ]
}